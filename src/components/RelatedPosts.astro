---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

interface Props {
  currentPost: CollectionEntry<"blog">;
  category: string;
}

const { currentPost, category } = Astro.props;

const allPosts = await getCollection("blog");
const relatedPosts = allPosts
  .filter(
    (post) => post.data.category === category && post.slug !== currentPost.slug,
  )
  .slice(0, 3);
---

{
  relatedPosts.length > 0 && (
    <div class="space-y-12">
      <div class="space-y-2">
        <h2 class="text-[10px] uppercase tracking-[0.3em] text-refuge-muted font-medium">
          lecturas sugeridas
        </h2>
        <p class="text-2xl font-serif text-refuge-dark italic">
          Habitaciones contiguas
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        {relatedPosts.map((post) => (
          <article class="group space-y-4">
            <a href={`/blog/${post.slug}`} class="block space-y-4">
              <div class="flex items-center gap-4 text-[10px] uppercase tracking-widest text-refuge-muted">
                <span>{post.data.category}</span>
                <span class="w-4 h-px bg-refuge-accent/20" />
                <time datetime={post.data.publishDate.toISOString()}>
                  {new Date(post.data.publishDate).toLocaleDateString("es-ES", {
                    month: "short",
                    day: "numeric",
                  })}
                </time>
              </div>

              <h3 class="text-xl md:text-2xl font-serif text-refuge-dark group-hover:text-refuge-accent transition-colors leading-tight tracking-tight">
                {post.data.title}
              </h3>

              <p class="text-sm text-refuge-text font-light leading-relaxed line-clamp-2 italic serif opacity-80">
                {post.data.description}
              </p>

              <div class="pt-2">
                <span class="text-[10px] uppercase tracking-[0.2em] text-refuge-muted border-b border-transparent group-hover:border-refuge-accent pb-1 transition-all">
                  entrar
                </span>
              </div>
            </a>
          </article>
        ))}
      </div>
    </div>
  )
}
